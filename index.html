<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#7c3aed" id="theme-meta">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Fun English!">
  <title>Fun English!</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="https://placehold.co/32x32/7c3aed/ffffff?text=üî§">
  <link rel="icon" type="image/png" sizes="16x16" href="https://placehold.co/16x16/7c3aed/ffffff?text=üî§">
  <link rel="apple-touch-icon" href="https://placehold.co/192x192/7c3aed/ffffff?text=üî§" sizes="192x192">

  <!-- PWA Manifest -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Fun English!",
      "short_name": "Fun English",
      "description": "–û–±—É—á–µ–Ω–∏–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º—É —è–∑—ã–∫—É —á–µ—Ä–µ–∑ –∏–≥—Ä—ã",
      "url": ".",
      "screenshots": []
    }
  </script>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º React –∏ Tailwind -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/babel-standalone@6.26.0/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&family=Fredoka+One&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Baloo 2', cursive;
      min-height: 100vh;
      padding-top: 120px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      transition: background 0.5s ease;
    }
    body.day {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    }
    body.night {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    }
    .title-font {
      font-family: 'Fredoka One', cursive;
    }
    .card-3d {
      transform-style: preserve-3d;
      transition: all 0.5s ease;
    }
    .card-3d:hover {
      transform: rotateY(10deg) rotateX(5deg) scale(1.05);
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    }
    .flip-card {
      perspective: 1000px;
    }
    .flip-card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    .flip-card.flipped .flip-card-inner {
      transform: rotateY(180deg);
    }
    .flip-card-front, .flip-card-back {
      backface-visibility: hidden;
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
    }
    .flip-card-back {
      transform: rotateY(180deg);
    }
    .bounce {
      animation: bounce 2s infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    .pulse {
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    .float {
      animation: float 6s ease-in-out infinite;
    }
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-15px); }
      100% { transform: translateY(0px); }
    }
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      background-color: #f00;
      opacity: 0;
    }
    .animate-shake {
      animation: shake 0.5s;
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
    .word-match-card {
      transition: all 0.3s;
    }
    .word-match-card:hover {
      transform: scale(1.05);
    }
    .word-match-card.selected {
      transform: scale(0.95);
      box-shadow: 0 0 0 3px #4f46e5;
    }
    .word-match-card.correct {
      background-color: #10b981 !important;
    }
    .word-match-card.incorrect {
      background-color: #ef4444 !important;
    }
    .speaking {
      animation: speaking 1.5s infinite;
    }
    @keyframes speaking {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
  </style>
</head>
<body class="day">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const flashcards = [
      { word: "Cat", translation: "–ö–æ—Ç", image: "https://placehold.co/400x300/ff6b6b/ffffff?text=üê±+Cat", category: "Animals", sound: "https://www.soundjay.com/meow/sounds/cat-meow-01.mp3" },
      { word: "Dog", translation: "–°–æ–±–∞–∫–∞", image: "https://placehold.co/400x300/4ecdc4/ffffff?text=üê∂+Dog", category: "Animals", sound: "https://www.soundjay.com/dog/sounds/dog-bark-01.mp3" },
      { word: "Bird", translation: "–ü—Ç–∏—Ü–∞", image: "https://placehold.co/400x300/a8e6cf/000000?text=üê¶+Bird", category: "Animals", sound: "https://www.soundjay.com/birds/sounds/bird-chirp-01.mp3" },
      { word: "Elephant", translation: "–°–ª–æ–Ω", image: "https://placehold.co/400x300/77dd77/ffffff?text=üêò+Elephant", category: "Animals", sound: "https://www.soundjay.com/animals/sounds/elephant-1.mp3" },
      { word: "Lion", translation: "–õ–µ–≤", image: "https://placehold.co/400x300/ffb347/ffffff?text=ü¶Å+Lion", category: "Animals", sound: "https://www.soundjay.com/animals/sounds/lion-1.mp3" },
      { word: "Monkey", translation: "–û–±–µ–∑—å—è–Ω–∞", image: "https://placehold.co/400x300/fdcb6e/000000?text=üêí+Monkey", category: "Animals", sound: "https://www.soundjay.com/animals/sounds/monkey-1.mp3" },
      { word: "Apple", translation: "–Ø–±–ª–æ–∫–æ", image: "https://placehold.co/400x300/e74c3c/ffffff?text=üçé+Apple", category: "Fruits", sound: "https://www.soundjay.com/human/sounds/bite-01.mp3" },
      { word: "Banana", translation: "–ë–∞–Ω–∞–Ω", image: "https://placehold.co/400x300/f1c40f/000000?text=üçå+Banana", category: "Fruits", sound: "https://www.soundjay.com/human/sounds/chew-01.mp3" },
      { word: "Orange", translation: "–ê–ø–µ–ª—å—Å–∏–Ω", image: "https://placehold.co/400x300/e67e22/ffffff?text=üçä+Orange", category: "Fruits", sound: "https://www.soundjay.com/human/sounds/squeeze-01.mp3" },
      { word: "Grapes", translation: "–í–∏–Ω–æ–≥—Ä–∞–¥", image: "https://placehold.co/400x300/8e44ad/ffffff?text=üçá+Grapes", category: "Fruits", sound: "https://www.soundjay.com/human/sounds/chew-02.mp3" },
      { word: "Strawberry", translation: "–ö–ª—É–±–Ω–∏–∫–∞", image: "https://placehold.co/400x300/c0392b/ffffff?text=üçì+Strawberry", category: "Fruits", sound: "https://www.soundjay.com/human/sounds/bite-02.mp3" },
      { word: "Watermelon", translation: "–ê—Ä–±—É–∑", image: "https://placehold.co/400x300/27ae60/ffffff?text=üçâ+Watermelon", category: "Fruits", sound: "https://www.soundjay.com/human/sounds/slice-01.mp3" },
      { word: "Carrot", translation: "–ú–æ—Ä–∫–æ–≤—å", image: "https://placehold.co/400x300/d35400/ffffff?text=ü•ï+Carrot", category: "Vegetables", sound: "https://www.soundjay.com/human/sounds/crunch-01.mp3" },
      { word: "Tomato", translation: "–ü–æ–º–∏–¥–æ—Ä", image: "https://placehold.co/400x300/c0392b/ffffff?text=üçÖ+Tomato", category: "Vegetables", sound: "https://www.soundjay.com/human/sounds/squish-01.mp3" },
      { word: "Potato", translation: "–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å", image: "https://placehold.co/400x300/b7950b/ffffff?text=ü•î+Potato", category: "Vegetables", sound: "https://www.soundjay.com/human/sounds/peel-01.mp3" },
      { word: "Cucumber", translation: "–û–≥—É—Ä–µ—Ü", image: "https://placehold.co/400x300/2ecc71/000000?text=ü•í+Cucumber", category: "Vegetables", sound: "https://www.soundjay.com/human/sounds/crunch-02.mp3" },
      { word: "Onion", translation: "–õ—É–∫", image: "https://placehold.co/400x300/af7ac5/ffffff?text=üßÖ+Onion", category: "Vegetables", sound: "https://www.soundjay.com/human/sounds/cut-01.mp3" },
      { word: "Pepper", translation: "–ü–µ—Ä–µ—Ü", image: "https://placehold.co/400x300/e74c3c/ffffff?text=üå∂Ô∏è+Pepper", category: "Vegetables", sound: "https://www.soundjay.com/human/sounds/slice-02.mp3" },
      { word: "Car", translation: "–ú–∞—à–∏–Ω–∞", image: "https://placehold.co/400x300/3498db/ffffff?text=üöó+Car", category: "Transport", sound: "https://www.soundjay.com/vehicles/sounds/car-horn-1.mp3" },
      { word: "Bus", translation: "–ê–≤—Ç–æ–±—É—Å", image: "https://placehold.co/400x300/9b59b6/ffffff?text=üöå+Bus", category: "Transport", sound: "https://www.soundjay.com/vehicles/sounds/bus-horn-1.mp3" },
      { word: "Bicycle", translation: "–í–µ–ª–æ—Å–∏–ø–µ–¥", image: "https://placehold.co/400x300/1abc9c/ffffff?text=üö≤+Bicycle", category: "Transport", sound: "https://www.soundjay.com/mechanical/sounds/bicycle-bell-1.mp3" },
      { word: "Train", translation: "–ü–æ–µ–∑–¥", image: "https://placehold.co/400x300/34495e/ffffff?text=üöÇ+Train", category: "Transport", sound: "https://www.soundjay.com/vehicles/sounds/train-whistle-1.mp3" },
      { word: "Airplane", translation: "–°–∞–º–æ–ª–µ—Ç", image: "https://placehold.co/400x300/2980b9/ffffff?text=‚úàÔ∏è+Airplane", category: "Transport", sound: "https://www.soundjay.com/vehicles/sounds/airplane-landing-1.mp3" },
      { word: "Boat", translation: "–õ–æ–¥–∫–∞", image: "https://placehold.co/400x300/16a085/ffffff?text=‚õµ+Boat", category: "Transport", sound: "https://www.soundjay.com/vehicles/sounds/boat-horn-1.mp3" },
    ];

    // –•—Ä–∞–Ω–∏–ª–∏—â–µ
    function saveToStorage(key, value) {
      try {
        localStorage.setItem(key, JSON.stringify(value));
      } catch (e) {
        console.warn("localStorage –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω");
      }
    }

    function loadFromStorage(key, defaultValue) {
      try {
        const item = localStorage.getItem(key);
        return item ? JSON.parse(item) : defaultValue;
      } catch (e) {
        return defaultValue;
      }
    }

    function App() {
      const [stars, setStars] = useState(() => loadFromStorage('stars', 0));
      const [activeTab, setActiveTab] = useState("cards");
      const [speaking, setSpeaking] = useState(false);
      const [isNight, setIsNight] = useState(() => loadFromStorage('theme', false));

      useEffect(() => {
        saveToStorage('stars', stars);
      }, [stars]);

      useEffect(() => {
        saveToStorage('theme', isNight);
        document.body.className = isNight ? 'night' : 'day';
        document.getElementById('theme-meta').setAttribute('content', isNight ? '#16213e' : '#7c3aed');
      }, [isNight]);

      const addStars = (amount) => {
        setStars(prev => prev + amount);
        if (amount >= 5) createConfetti();
      };

      const createConfetti = () => {
        const colors = ['#f00', '#0f0', '#00f', '#ff0', '#f0f', '#0ff'];
        for (let i = 0; i < 50; i++) {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.left = `${Math.random() * 100}vw`;
          confetti.style.top = '-10px';
          confetti.style.width = `${Math.random() * 10 + 5}px`;
          confetti.style.height = `${Math.random() * 10 + 5}px`;
          confetti.style.opacity = '1';
          confetti.style.borderRadius = '50%';
          document.body.appendChild(confetti);
          const animationDuration = Math.random() * 3 + 2;
          confetti.style.transition = `all ${animationDuration}s ease-out`;
          setTimeout(() => {
            confetti.style.transform = `translateY(${window.innerHeight}px) rotate(${Math.random() * 360}deg)`;
            confetti.style.opacity = '0';
          }, 10);
          setTimeout(() => {
            document.body.removeChild(confetti);
          }, animationDuration * 1000);
        }
      };

      const speakText = (text) => {
        if ('speechSynthesis' in window) {
          setSpeaking(true);
          const utterance = new SpeechSynthesisUtterance(text);
          utterance.lang = 'en-US';
          utterance.onend = () => setSpeaking(false);
          speechSynthesis.speak(utterance);
        } else {
          alert("–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏");
        }
      };

      return (
        <div className="min-h-screen flex flex-col">
          <Header 
            stars={stars} 
            activeTab={activeTab} 
            setActiveTab={setActiveTab} 
            isNight={isNight} 
            setIsNight={setIsNight} 
          />
          <main className="flex-grow overflow-y-auto">
            {activeTab === "cards" && <Flashcards addStars={addStars} speakText={speakText} speaking={speaking} />}
            {activeTab === "guess" && <Game addStars={addStars} speakText={speakText} speaking={speaking} />}
            {activeTab === "match" && <WordMatchGame addStars={addStars} speakText={speakText} speaking={speaking} />}
            {activeTab === "listen" && <ListenGame addStars={addStars} speakText={speakText} speaking={speaking} />}
          </main>
          <Footer isNight={isNight} />
        </div>
      );
    }

    function Header({ stars, activeTab, setActiveTab, isNight, setIsNight }) {
      return (
        <header className={`p-4 text-center shadow-lg sticky top-0 z-50 transition-colors ${isNight ? 'bg-gradient-to-r from-gray-800 to-gray-900' : 'bg-gradient-to-r from-purple-500 to-indigo-600'}`}>
          <div className="container mx-auto flex flex-col md:flex-row justify-between items-center">
            <h1 className="text-2xl md:text-3xl font-bold text-white drop-shadow-lg bounce title-font">Fun English!</h1>
            <div className="flex items-center gap-3 mt-2 md:mt-0">
              <div className="bg-yellow-400 px-4 py-2 rounded-full shadow-md flex items-center">
                <span className="text-xl font-bold text-gray-800 mr-2">{stars}</span>
                <span className="text-2xl">‚≠ê</span>
              </div>
              <button 
                onClick={() => setIsNight(!isNight)} 
                className="p-2 rounded-full bg-white text-gray-800 shadow-md hover:scale-110 transition-all"
                aria-label={isNight ? "–í–∫–ª—é—á–∏—Ç—å –¥–µ–Ω—å" : "–í–∫–ª—é—á–∏—Ç—å –Ω–æ—á—å"}
              >
                {isNight ? "‚òÄÔ∏è" : "üåô"}
              </button>
            </div>
          </div>
          <nav className="mt-3 flex flex-wrap justify-center gap-2">
            {["cards", "guess", "match", "listen"].map((tab) => (
              <button
                key={tab}
                onClick={() => setActiveTab(tab)}
                className={`px-3 py-1.5 md:px-4 md:py-2 rounded-full text-xs md:text-sm font-semibold transition-all ${
                  activeTab === tab 
                    ? "bg-white text-purple-600 shadow-md scale-105" 
                    : "text-white hover:bg-opacity-80"
                }`}
              >
                {tab === "cards" && "–ö–∞—Ä—Ç–æ—á–∫–∏"}
                {tab === "guess" && "–£–≥–∞–¥–∞–π"}
                {tab === "match" && "–°–æ–ø–æ—Å—Ç–∞–≤—å"}
                {tab === "listen" && "–°–ª—É—à–∞–π"}
              </button>
            ))}
          </nav>
        </header>
      );
    }

    function Flashcards({ addStars, speakText, speaking }) {
      const [currentCard, setCurrentCard] = useState(0);
      const [category, setCategory] = useState("Animals");
      const [flipped, setFlipped] = useState(false);
      const [audio, setAudio] = useState(null);

      const filteredCards = flashcards.filter(card => card.category === category);
      const nextCard = () => {
        setCurrentCard((prev) => (prev + 1) % filteredCards.length);
        setFlipped(false);
        if (audio) audio.pause();
      };
      const prevCard = () => {
        setCurrentCard((prev) => (prev - 1 + filteredCards.length) % filteredCards.length);
        setFlipped(false);
        if (audio) audio.pause();
      };
      const playSound = () => {
        if (audio) audio.pause();
        const newAudio = new Audio(filteredCards[currentCard].sound);
        setAudio(newAudio);
        newAudio.play();
        addStars(1);
      };
      const flipCard = () => {
        setFlipped(!flipped);
        if (!flipped) addStars(1);
      };

      return (
        <section className="p-4 pb-20 text-center min-h-screen">
          <h2 className="text-2xl md:text-3xl font-bold mb-4 title-font">–£—á–∏ —Å–ª–æ–≤–∞!</h2>
          <div className="flex flex-wrap justify-center gap-2 mb-4">
            {["Animals", "Fruits", "Vegetables", "Transport"].map((cat) => (
              <button
                key={cat}
                onClick={() => { setCategory(cat); setCurrentCard(0); setFlipped(false); }}
                className={`px-3 py-1.5 rounded-full text-sm font-semibold shadow-md transition-all ${
                  category === cat 
                    ? `${cat === "Animals" ? "bg-blue-600" : cat === "Fruits" ? "bg-green-600" : cat === "Vegetables" ? "bg-orange-600" : "bg-purple-600"} text-white`
                    : "bg-white text-gray-800 hover:bg-gray-100"
                }`}
              >
                {cat === "Animals" ? "üê±" : cat === "Fruits" ? "üçé" : cat === "Vegetables" ? "ü•ï" : "üöó"} {cat}
              </button>
            ))}
          </div>
          <div className="max-w-xs md:max-w-md mx-auto mb-6">
            <div className={`flip-card ${flipped ? 'flipped' : ''}`} onClick={flipCard} style={{ height: '280px' }}>
              <div className="flip-card-inner">
                <div className="flip-card-front">
                  <div className="bg-white rounded-2xl shadow-2xl overflow-hidden card-3d cursor-pointer" style={{ height: '100%' }}>
                    <img src={filteredCards[currentCard].image} alt={filteredCards[currentCard].word} className="w-full h-48 object-cover" />
                    <div className="p-4">
                      <h3 className="text-2xl font-bold text-gray-800">{filteredCards[currentCard].word}</h3>
                      <p className="text-gray-500 text-sm mt-1">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—å</p>
                    </div>
                  </div>
                </div>
                <div className="flip-card-back">
                  <div className="bg-indigo-100 rounded-2xl shadow-2xl overflow-hidden card-3d h-full flex flex-col justify-center cursor-pointer">
                    <div className="p-4">
                      <h3 className="text-2xl font-bold text-indigo-800">{filteredCards[currentCard].translation}</h3>
                      <p className="text-gray-600 text-sm mt-1">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div className="flex flex-wrap justify-center gap-3">
            <button onClick={prevCard} className="px-4 py-2 bg-white text-blue-600 rounded-full font-semibold shadow-md hover:bg-gray-100 hover:scale-105 transition-all text-sm flex items-center min-w-20">
              ‚Üê –ù–∞–∑–∞–¥
            </button>
            <button onClick={() => speakText(filteredCards[currentCard].word)} className={`px-4 py-2 bg-purple-600 text-white rounded-full font-semibold shadow-md hover:bg-purple-700 hover:scale-105 transition-all text-sm flex items-center ${speaking ? 'speaking' : ''}`}>
              üó£Ô∏è
            </button>
            <button onClick={playSound} className="px-4 py-2 bg-blue-600 text-white rounded-full font-semibold shadow-md hover:bg-blue-700 hover:scale-105 transition-all text-sm flex items-center">
              üîä
            </button>
            <button onClick={nextCard} className="px-4 py-2 bg-white text-blue-600 rounded-full font-semibold shadow-md hover:bg-gray-100 hover:scale-105 transition-all text-sm flex items-center min-w-20">
              –í–ø–µ—Ä–µ–¥ ‚Üí
            </button>
          </div>
          <div className="mt-4 text-gray-600 text-sm">
            {currentCard + 1} / {filteredCards.length}
          </div>
        </section>
      );
    }

    function Game({ addStars, speakText, speaking }) {
      const [currentCard, setCurrentCard] = useState(Math.floor(Math.random() * flashcards.length));
      const [score, setScore] = useState(0);
      const [options, setOptions] = useState([]);
      const [message, setMessage] = useState("");
      const [shake, setShake] = useState(false);
      const [celebrate, setCelebrate] = useState(false);

      useEffect(() => {
        const correct = flashcards[currentCard];
        const wrong = flashcards.filter((_, i) => i !== currentCard).sort(() => Math.random() - 0.5).slice(0, 3);
        const opts = [correct, ...wrong].sort(() => Math.random() - 0.5);
        setOptions(opts);
      }, [currentCard]);

      const checkAnswer = (selected) => {
        if (selected === flashcards[currentCard].word) {
          setScore(score + 1);
          setMessage("–ú–æ–ª–æ–¥–µ—Ü! ‚≠ê +5 –∑–≤–µ–∑–¥");
          setCelebrate(true);
          addStars(5);
          setTimeout(() => {
            setCurrentCard(Math.floor(Math.random() * flashcards.length));
            setMessage("");
            setCelebrate(false);
          }, 1500);
        } else {
          setMessage("–ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑!");
          setShake(true);
          setTimeout(() => setShake(false), 500);
        }
      };

      return (
        <section className="p-4 pb-20 text-center min-h-screen">
          <h2 className="text-2xl md:text-3xl font-bold mb-4 title-font">–£–≥–∞–¥–∞–π —Å–ª–æ–≤–æ!</h2>
          <div className="flex justify-center items-center mb-4">
            <div className="bg-white rounded-full px-4 py-2 shadow-lg flex items-center">
              <span className="text-xl mr-2">‚≠ê</span>
              <span className="text-lg font-bold text-gray-800">–°—á—ë—Ç: {score}</span>
            </div>
          </div>
          <div className={`max-w-xs md:max-w-md mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden transition-all ${shake ? 'animate-shake' : ''} ${celebrate ? 'ring-4 ring-yellow-400' : ''}`}>
            <img src={flashcards[currentCard].image} alt="Guess" className="w-full h-48 object-cover" />
            <div className="p-4">
              <div className="flex justify-center mb-3">
                <button onClick={() => speakText(flashcards[currentCard].word)} className={`px-4 py-2 bg-purple-600 text-white rounded-full font-semibold shadow-md hover:bg-purple-700 transition-all text-sm flex items-center ${speaking ? 'speaking' : ''}`}>
                  üó£Ô∏è –ü—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏
                </button>
              </div>
              <h3 className="text-lg font-semibold text-gray-700 mb-3">–ß—Ç–æ —ç—Ç–æ –ø–æ-–∞–Ω–≥–ª–∏–π—Å–∫–∏?</h3>
              <div className="grid grid-cols-2 gap-2">
                {options.map((option) => (
                  <button key={option.word} onClick={() => checkAnswer(option.word)} className="px-3 py-2 bg-gradient-to-r from-purple-100 to-indigo-100 text-gray-800 rounded-lg font-semibold shadow-md hover:from-purple-200 hover:to-indigo-200 hover:scale-105 transition-all text-sm">
                    {option.word}
                  </button>
                ))}
              </div>
              {message && (
                <div className={`mt-3 p-2 rounded-lg text-xs font-semibold ${message.includes("–ú–æ–ª–æ–¥–µ—Ü") ? "bg-green-100 text-green-800" : "bg-red-100 text-red-800"}`}>
                  {message}
                </div>
              )}
            </div>
          </div>
          <button onClick={() => { setCurrentCard(Math.floor(Math.random() * flashcards.length)); setMessage(""); }} className="mt-4 px-5 py-2 bg-white text-purple-600 rounded-full font-semibold shadow-md hover:bg-gray-100 hover:scale-105 transition-all text-sm">
            –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å
          </button>
        </section>
      );
    }

    function WordMatchGame({ addStars, speakText, speaking }) {
      const [selectedCards, setSelectedCards] = useState([]);
      const [matchedPairs, setMatchedPairs] = useState([]);
      const [moves, setMoves] = useState(0);
      const [gameCompleted, setGameCompleted] = useState(false);
      const [cards, setCards] = useState(() => {
        const selectedFlashcards = [...flashcards].sort(() => 0.5 - Math.random()).slice(0, 6);
        const wordCards = selectedFlashcards.map(card => ({
          id: `word-${card.word}`,
          type: 'word',
          content: card.word,
          matchId: `image-${card.word}`,
          translation: card.translation
        }));
        const imageCards = selectedFlashcards.map(card => ({
          id: `image-${card.word}`,
          type: 'image',
          content: card.image,
          matchId: `word-${card.word}`,
          translation: card.translation
        }));
        return [...wordCards, ...imageCards].sort(() => 0.5 - Math.random());
      });

      const handleCardClick = (card) => {
        if (selectedCards.length === 2 || matchedPairs.includes(card.id) || selectedCards.some(c => c.id === card.id)) return;
        setSelectedCards([...selectedCards, card]);
        if (selectedCards.length === 1) {
          setMoves(moves + 1);
          const [firstCard] = selectedCards;
          if (firstCard.matchId === card.id) {
            setMatchedPairs([...matchedPairs, firstCard.id, card.id]);
            addStars(3);
            if (matchedPairs.length + 2 === cards.length) {
              setGameCompleted(true);
              addStars(10);
            }
          }
          setTimeout(() => setSelectedCards([]), 1000);
        }
      };

      const resetGame = () => {
        setSelectedCards([]);
        setMatchedPairs([]);
        setMoves(0);
        setGameCompleted(false);
        const selectedFlashcards = [...flashcards].sort(() => 0.5 - Math.random()).slice(0, 6);
        const wordCards = selectedFlashcards.map(card => ({ id: `word-${card.word}`, type: 'word', content: card.word, matchId: `image-${card.word}`, translation: card.translation }));
        const imageCards = selectedFlashcards.map(card => ({ id: `image-${card.word}`, type: 'image', content: card.image, matchId: `word-${card.word}`, translation: card.translation }));
        setCards([...wordCards, ...imageCards].sort(() => 0.5 - Math.random()));
      };

      return (
        <section className="p-4 pb-20 text-center min-h-screen">
          <h2 className="text-2xl md:text-3xl font-bold mb-4 title-font">–°–æ–ø–æ—Å—Ç–∞–≤—å —Å–ª–æ–≤–∞ –∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏!</h2>
          <div className="flex justify-center items-center mb-4">
            <div className="bg-white rounded-full px-4 py-2 shadow-lg flex items-center">
              <span className="text-lg font-bold text-gray-800 mr-3">–•–æ–¥—ã: {moves}</span>
              <span className="text-lg font-bold text-gray-800">–ü–∞—Ä: {matchedPairs.length / 2}</span>
            </div>
          </div>
          {gameCompleted && (
            <div className="max-w-xs mx-auto bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-3 mb-4 rounded text-sm">
              <p className="font-bold">üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</p>
              <p>–¢—ã –∑–∞—Ä–∞–±–æ—Ç–∞–ª 10 –∑–≤—ë–∑–¥!</p>
            </div>
          )}
          <div className="grid grid-cols-2 gap-2 max-w-xs md:max-w-4xl mx-auto">
            {cards.map((card) => {
              const isSelected = selectedCards.some(c => c.id === card.id);
              const isMatched = matchedPairs.includes(card.id);
              const isVisible = isSelected || isMatched;
              return (
                <div key={card.id} onClick={() => !isMatched && handleCardClick(card)} className={`word-match-card h-20 rounded-lg shadow-md flex items-center justify-center cursor-pointer transition-all text-xs ${isMatched ? 'correct' : isSelected ? 'selected' : card.type === 'word' ? 'bg-blue-100 hover:bg-blue-200' : 'bg-green-100 hover:bg-green-200'}`}>
                  {isVisible ? (
                    card.type === 'word' ? (
                      <div className="text-center p-1">
                        <h3 className="font-bold text-gray-800">{card.content}</h3>
                        <p className="text-gray-600">{card.translation}</p>
                      </div>
                    ) : (
                      <img src={card.content} alt={card.translation} className="w-full h-full object-cover rounded-lg" />
                    )
                  ) : (
                    <div className="w-full h-full bg-gray-300 rounded-lg flex items-center justify-center">
                      <span className="text-2xl">?</span>
                    </div>
                  )}
                </div>
              );
            })}
          </div>
          <button onClick={resetGame} className="mt-6 px-5 py-2 bg-teal-600 text-white rounded-full font-semibold shadow-md hover:bg-teal-700 hover:scale-105 transition-all text-sm">
            –ù–æ–≤–∞—è –∏–≥—Ä–∞
          </button>
        </section>
      );
    }

    function ListenGame({ addStars, speakText, speaking }) {
      const [currentCard, setCurrentCard] = useState(Math.floor(Math.random() * flashcards.length));
      const [options, setOptions] = useState([]);
      const [score, setScore] = useState(0);
      const [message, setMessage] = useState("");
      const [autoPlay, setAutoPlay] = useState(true);

      useEffect(() => {
        const correct = flashcards[currentCard];
        const wrong = flashcards.filter((_, i) => i !== currentCard).sort(() => Math.random() - 0.5).slice(0, 3);
        const opts = [correct, ...wrong].sort(() => Math.random() - 0.5);
        setOptions(opts);
        if (autoPlay) speakText(flashcards[currentCard].word);
      }, [currentCard]);

      const checkAnswer = (selected) => {
        if (selected === flashcards[currentCard].word) {
          setScore(score + 1);
          setMessage("–ü—Ä–∞–≤–∏–ª—å–Ω–æ! +3 –∑–≤–µ–∑–¥—ã ‚≠ê");
          addStars(3);
          setTimeout(() => {
            setCurrentCard(Math.floor(Math.random() * flashcards.length));
            setMessage("");
          }, 1500);
        } else {
          setMessage(`–ù–µ–≤–µ—Ä–Ω–æ! –≠—Ç–æ "${flashcards[currentCard].word}"`);
        }
      };

      const playWord = () => {
        speakText(flashcards[currentCard].word);
      };

      return (
        <section className="p-4 pb-20 text-center min-h-screen">
          <h2 className="text-2xl md:text-3xl font-bold mb-4 title-font">–°–ª—É—à–∞–π –∏ –≤—ã–±–∏—Ä–∞–π!</h2>
          <div className="flex justify-center items-center mb-4">
            <div className="bg-white rounded-full px-4 py-2 shadow-lg flex items-center">
              <span className="text-xl mr-2">‚≠ê</span>
              <span className="text-lg font-bold text-gray-800">–°—á—ë—Ç: {score}</span>
            </div>
          </div>
          <div className="max-w-xs mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden p-4">
            <div className="flex justify-center mb-3">
              <button onClick={playWord} className={`px-5 py-2 bg-amber-600 text-white rounded-full font-semibold shadow-md hover:bg-amber-700 transition-all text-sm flex items-center ${speaking ? 'speaking' : ''}`}>
                üîä –ü—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏
              </button>
            </div>
            <div className="flex items-center justify-center mb-3">
              <label className="inline-flex items-center cursor-pointer">
                <input type="checkbox" className="sr-only peer" checked={autoPlay} onChange={() => setAutoPlay(!autoPlay)} />
                <div className="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-amber-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-amber-600"></div>
                <span className="ms-2 text-xs font-medium text-gray-900">–ê–≤—Ç–æ</span>
              </label>
            </div>
            <h3 className="text-lg font-semibold text-gray-700 mb-3">–ö–∞–∫–æ–µ —Å–ª–æ–≤–æ —Ç—ã —É—Å–ª—ã—à–∞–ª?</h3>
            <div className="grid grid-cols-2 gap-2">
              {options.map((option) => (
                <button key={option.word} onClick={() => checkAnswer(option.word)} className="px-3 py-2 bg-gradient-to-r from-amber-100 to-orange-100 text-gray-800 rounded-lg font-semibold shadow-md hover:from-amber-200 hover:to-orange-200 hover:scale-105 transition-all text-xs">
                  {option.word}
                </button>
              ))}
            </div>
            {message && (
              <div className={`mt-3 p-2 rounded-lg text-xs font-semibold ${message.includes("–ü—Ä–∞–≤–∏–ª—å–Ω–æ") ? "bg-green-100 text-green-800" : "bg-red-100 text-red-800"}`}>
                {message}
              </div>
            )}
          </div>
          <button onClick={() => { setCurrentCard(Math.floor(Math.random() * flashcards.length)); setMessage(""); }} className="mt-4 px-5 py-2 bg-white text-amber-600 rounded-full font-semibold shadow-md hover:bg-gray-100 hover:scale-105 transition-all text-sm">
            –°–ª–µ–¥—É—é—â–µ–µ
          </button>
        </section>
      );
    }

    function Footer({ isNight }) {
      return (
        <footer className={`p-4 text-center text-white text-sm transition-colors ${isNight ? 'bg-gray-900' : 'bg-gradient-to-r from-purple-600 to-indigo-700'}`}>
          <p>¬© 2025 Fun English! –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
          <div className="mt-2 flex flex-wrap justify-center gap-3">
            <a href="#" className="hover:text-yellow-300 transition-colors text-xs">–ü–æ–ª–∏—Ç–∏–∫–∞</a>
            <a href="#" className="hover:text-yellow-300 transition-colors text-xs">–£—Å–ª–æ–≤–∏—è</a>
            <a href="#" className="hover:text-yellow-300 transition-colors text-xs">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
          </div>
        </footer>
      );
    }

    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch(e => console.log('SW registration failed'));
      });
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>

  <!-- Service Worker –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞ -->
  <script id="sw">
    const CACHE_NAME = 'fun-english-v1';
    const urlsToCache = [
      '/',
      '/index.html',
      'https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js',
      'https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js',
      'https://cdn.jsdelivr.net/npm/babel-standalone@6.26.0/babel.min.js',
      'https://cdn.tailwindcss.com'
    ];

    self.addEventListener('install', (event) => {
      event.waitUntil(
        caches.open(CACHE_NAME).then((cache) => {
          return cache.addAll(urlsToCache);
        })
      );
    });

    self.addEventListener('fetch', (event) => {
      event.respondWith(
        caches.match(event.request).then((response) => {
          return response || fetch(event.request);
        })
      );
    });
  </script>
</body>
</html>
